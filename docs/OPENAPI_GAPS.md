# OpenAPI Specification Gaps

**Status**: Identified from test run on 2025-01-XX
**Generated by**: `npm run test:openapi`

## Summary

The OpenAPI validation test revealed several discrepancies between the documented API spec and the actual implementation. These need to be resolved to ensure documentation accuracy and enable proper Postman collection generation.

## Gaps Identified

### 1. Routes Documented but NOT Implemented

These endpoints are in `docs/api-spec.yaml` but don't exist in the code:

- **GET /server-info** - Should be removed or implemented
  - *Decision needed*: Remove from spec or implement endpoint?
  - *Context*: Server info is returned as part of `/connect` response
  
- **POST /ocr/extract** - Not implemented
  - *Decision needed*: OCR extraction may be handled client-side only
  - *Action*: Remove from spec (mobile app does OCR locally)
  
- **GET /items/code-suggestions** - Path mismatch
  - *Documented as*: `/items/code-suggestions`
  - *Actually implemented as*: `/api/v1/products/search`
  - *Action*: Update spec to use correct path

### 2. Routes Implemented but NOT Documented

These endpoints exist in code but aren't in `docs/api-spec.yaml`:

- **GET /api/v1/products/search** - Missing from spec
  - *Implemented*: Yes, in routes/products.js
  - *Action*: Already exists as `/items/code-suggestions` - path mismatch (see above)

### 3. HTTP Method Mismatches

OpenAPI spec documents methods that don't match implementation:

#### Transactions Routes
- **GET /transactions** - Missing from spec
  - *Spec*: Only has POST
  - *Implementation*: Has both GET and POST
  - *Action*: Add GET method to spec
  
- **GET /transactions/:id** - Missing from spec
  - *Spec*: Only has PUT and DELETE
  - *Implementation*: Has GET, PUT, and DELETE
  - *Action*: Add GET method to spec
  
- **PUT /transactions/:id** - Implementation has it
  - *Status*: Spec has it, implementation has it ✅
  
- **DELETE /transactions/:id** - Implementation has it
  - *Status*: Spec has it, implementation has it ✅

#### Payees Route
- **POST /payees** - Implementation issue
  - *Spec*: Has POST
  - *Implementation*: Only has GET currently
  - *Action*: Either remove POST from spec or implement it

### 4. Path Prefix Inconsistencies

Some routes in spec are missing the `/api/v1` prefix:

- `/accounts` should be `/api/v1/accounts`
- `/payees` should be `/api/v1/payees`
- `/transactions` should be `/api/v1/transactions`
- `/items/code-suggestions` should be `/api/v1/products/search`
- `/google-sheets/*` should be `/api/v1/google-sheets/*`

**Note**: `/health` is correctly without prefix (top-level health check)

## Recommended Actions

### Priority 1: Path Fixes (Required for Postman)

1. **Fix path prefix consistency**:
   ```yaml
   # Change from:
   /accounts:
   /payees:
   /transactions:
   
   # To:
   /api/v1/accounts:
   /api/v1/payees:
   /api/v1/transactions:
   ```

2. **Fix products/items path mismatch**:
   ```yaml
   # Change from:
   /items/code-suggestions:
   
   # To:
   /api/v1/products/search:
   ```

3. **Fix Google Sheets paths**:
   ```yaml
   # Change from:
   /google-sheets/sync/draft:
   
   # To:
   /api/v1/google-sheets/sync/draft:
   ```

### Priority 2: Missing Methods

1. **Add GET methods to transactions**:
   ```yaml
   /api/v1/transactions:
     get:  # ADD THIS
       summary: List transactions
       # ... (already in spec but not detected due to path mismatch)
     post:
       # ... (exists)
   
   /api/v1/transactions/{id}:
     get:  # ADD THIS
       summary: Get transaction by ID
       # ... (already in spec but not detected due to path mismatch)
     put:
       # ... (exists)
     delete:
       # ... (exists)
   ```

### Priority 3: Remove Unimplemented Routes

1. **Remove or implement**:
   - `/server-info` - Recommend removing (info returned in /connect)
   - `/ocr/extract` - Recommend removing (done client-side)

2. **Decide on POST /payees**:
   - Either implement endpoint in code
   - Or remove from spec if not needed yet

## Testing After Fixes

After making changes, run:

```bash
# 1. Validate OpenAPI spec
npm run test:openapi

# 2. Regenerate Postman collection
npm run postman:generate

# 3. Verify Postman collection completeness
# Import into Postman and verify all folders/requests present
```

## Expected Outcome

After fixes, validation should show:
- ✅ 0 routes documented but not implemented
- ✅ 0 routes implemented but not documented
- ✅ 0 HTTP method mismatches
- ✅ Consistent path naming (all using /api/v1 prefix)

Then Postman collection will accurately reflect all available endpoints.

